{% extends "layout.html" %}
{% load quiz_extras %}

{% block title %}Custom Quiz{% endblock %}

{% block content %}
<h1 class="centered-title">Custom Quiz</h1>

<div class="quiz-container">

 <!-- ───── Sidebar ───── -->
<div class="question-sidebar">
  <h3>Questions</h3>

  <div class="question-grid">
    {% for q in questions %}
      {% with status=question_statuses|get_item:q.id %}
        <a href="{% url 'custom_quiz_detail' q.id %}"
           class="question-link
             {% if status == 'correct' %}question-correct
             {% elif status == 'incorrect' %}question-incorrect
             {% else %}question-unanswered{% endif %}
             {% if q.id == question.id %} active{% endif %}">
          {{ forloop.counter }}
        </a>
      {% endwith %}
    {% endfor %}
  </div>

  <form method="post" action="{% url 'custom_quiz_result' %}">
    {% csrf_token %}
    <button class="btn-finish-quiz sidebar-end-btn">End&nbsp;Quiz</button>
  </form>
</div>



  <!-- ───── Main panel ───── -->
  <div class="question-content">
    <div class="question-container">
      <h2><span class="question-count">Q{{ current_index }} / {{ total_questions }}</span>{{ question.text }}</h2>
      {% if question.images.all %}
        <a href="#image-container" class="show-image-link">Show Image</a>
      {% endif %}

      <form method="post">
        {% csrf_token %}
        <div class="options">
          {% for opt in option_list %}
            <label class="option-label">
              <input type="radio" name="selected_option" value="{{ opt }}"
                     {% if selected_option == opt %}checked{% endif %}
                     {% if answered %}disabled{% endif %}>
              <span>{{ question|get_field:opt }}</span>
            </label>
          {% endfor %}
        </div>

        {% if not answered %}
          <button type="submit" name="action" value="check_answer" class="btn-check-answer">Check Answer</button>
        {% endif %}

        {% if answered %}
          <div class="after-answer-buttons">
            {% if is_last_question %}
              <button type="submit" name="action" value="finish_quiz" class="btn-finish-quiz">Finish Quiz</button>
            {% else %}
              <button type="submit" name="action" value="next_question" class="btn-next-question">Next Question</button>
            {% endif %}
          </div>
        {% endif %}
      </form>

      {% if answered or explanation_html %}
        <div class="explanation">
          {% if is_correct is not none %}
            <p class="{% if is_correct %}correct-answer{% else %}incorrect-answer{% endif %}">
              {% if is_correct %}Correct!{% else %}Incorrect.{% endif %}
            </p>
          {% endif %}
          {% if explanation_html %}
            <p class="explanation-text">{{ explanation_html|safe }}</p>
          {% endif %}
        </div>
      {% endif %}

      {% if question.images.all %}
        <div id="image-container" class="hidden-image-container">
          {% for image in question.images.all %}
            <img src="{{ image.image.url }}" class="standard-image" alt="Question image">
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

